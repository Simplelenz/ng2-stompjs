!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs/operators"),require("@angular/core"),require("rxjs"),require("@stomp/stompjs"),require("angular2-uuid")):"function"==typeof define&&define.amd?define("@stomp/ng2-stompjs",["exports","rxjs/operators","@angular/core","rxjs","@stomp/stompjs","angular2-uuid"],t):t((e.stomp=e.stomp||{},e.stomp["ng2-stompjs"]={}),e.rxjs.operators,e.ng.core,e.rxjs,e.Stomp,e.angular2Uuid)}(this,function(e,u,t,n,r,c){"use strict";var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};var o={CLOSED:0,TRYING:1,CONNECTED:2,DISCONNECTING:3};o[o.CLOSED]="CLOSED",o[o.TRYING]="TRYING",o[o.CONNECTED]="CONNECTED",o[o.DISCONNECTING]="DISCONNECTING";var s=function(){function e(){var t=this;this.queuedMessages=[],this.debug=function(e){console.log(new Date,e)},this.on_connect=function(e){t.debug("Connected"),t._serverHeadersBehaviourSubject.next(e.headers),t.state.next(o.CONNECTED)},this.on_error=function(e){t.errorSubject.next(e),"object"==typeof e&&(e=e.body),t.debug("Error: "+e),t.client.connected||t.state.next(o.CLOSED)},this.state=new n.BehaviorSubject(o.CLOSED),this.connectObservable=this.state.pipe(u.filter(function(e){return e===o.CONNECTED})),this.connectObservable.subscribe(function(){t.sendQueuedMessages()}),this._serverHeadersBehaviourSubject=new n.BehaviorSubject(null),this.serverHeadersObservable=this._serverHeadersBehaviourSubject.pipe(u.filter(function(e){return null!==e})),this.errorSubject=new n.Subject}return Object.defineProperty(e.prototype,"config",{set:function(e){this._config=e},enumerable:!0,configurable:!0}),e.prototype.initStompClient=function(){this.disconnect(),"string"==typeof this._config.url?this.client=r.client(this._config.url):this.client=r.over(this._config.url),this.client.heartbeat.incoming=this._config.heartbeat_in,this.client.heartbeat.outgoing=this._config.heartbeat_out,this.client.reconnect_delay=this._config.reconnect_delay,this._config.debug||(this.debug=function(){}),this.client.debug=this.debug,this.setupOnReceive(),this.setupReceipts()},e.prototype.initAndConnect=function(){this.initStompClient(),this._config.headers||(this._config.headers={}),this.client.connect(this._config.headers,this.on_connect,this.on_error),this.debug("Connecting..."),this.state.next(o.TRYING)},e.prototype.disconnect=function(){var e=this;if(this.client){if(!this.client.connected)return void this.state.next(o.CLOSED);this.state.next(o.DISCONNECTING),this.client.disconnect(function(){return e.state.next(o.CLOSED)})}},e.prototype.connected=function(){return this.state.getValue()===o.CONNECTED},e.prototype.publish=function(e,t,n){void 0===n&&(n={}),this.connected()?this.client.send(e,n,t):(this.debug("Not connected, queueing "+t),this.queuedMessages.push({queueName:e,message:t,headers:n}))},e.prototype.sendQueuedMessages=function(){var e,t,n=this.queuedMessages;this.queuedMessages=[],this.debug("Will try sending queued messages "+n);try{for(var r=function o(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}(n),i=r.next();!i.done;i=r.next()){var s=i.value;this.debug("Attempting to send "+s),this.publish(s.queueName,s.message,s.headers)}}catch(u){e={error:u}}finally{try{i&&!i.done&&(t=r["return"])&&t.call(r)}finally{if(e)throw e.error}}},e.prototype.subscribe=function(r,i){var s=this;return void 0===i&&(i={}),this.debug("Request to subscribe "+r),i.ack||(i.ack="auto"),n.Observable.create(function(t){var e,n;return n=s.connectObservable.subscribe(function(){s.debug("Will subscribe to "+r),e=s.client.subscribe(r,function(e){t.next(e)},i)}),function(){s.debug("Stop watching connection state (for "+r+")"),n.unsubscribe(),s.state.getValue()===o.CONNECTED?(s.debug("Will unsubscribe from "+r+" at Stomp"),e.unsubscribe()):s.debug("Stomp not connected, no need to unsubscribe from "+r+" at Stomp")}}).pipe(u.share())},e.prototype.setupOnReceive=function(){var t=this;this.defaultMessagesObservable=new n.Subject,this.client.onreceive=function(e){t.defaultMessagesObservable.next(e)}},e.prototype.setupReceipts=function(){var t=this;this.receiptsObservable=new n.Subject,this.client.onreceipt=function(e){t.receiptsObservable.next(e)}},e.prototype.waitForReceipt=function(t,n){this.receiptsObservable.pipe(u.filter(function(e){return e.headers["receipt-id"]===t}),u.first()).subscribe(function(e){n(e)})},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[]},e}(),a=function(){function e(){}return e.decorators=[{type:t.Injectable}],e}(),p=function(n){function e(e){var t=n.call(this)||this;return t.config=e,t.initAndConnect(),t}return function r(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(e,n),e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:a}]},e}(s),l=function(){function e(){}return e.decorators=[{type:t.Injectable}],e}(),h=function(){function e(e,t){var n=this;this.stompService=e,this.stompRPCConfig=t,this._replyQueueName="/temp-queue/rpc-replies",this._setupReplyQueue=function(){return n.stompService.defaultMessagesObservable},t&&(t.replyQueueName&&(this._replyQueueName=t.replyQueueName),t.setupReplyQueue&&(this._setupReplyQueue=t.setupReplyQueue))}return e.prototype.rpc=function(e,t,n){return this.stream(e,t,n).pipe(u.first())},e.prototype.stream=function(r,i,s){var o=this;return void 0===s&&(s={}),this._repliesObservable||(this._repliesObservable=this._setupReplyQueue(this._replyQueueName,this.stompService)),n.Observable.create(function(t){var e,n=c.UUID.UUID();return e=o._repliesObservable.pipe(u.filter(function(e){return e.headers["correlation-id"]===n})).subscribe(function(e){t.next(e)}),s["reply-to"]=o._replyQueueName,s["correlation-id"]=n,o.stompService.publish(r,i,s),function(){e.unsubscribe()}})},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:s},{type:l}]},e}();e.StompRService=s,e.StompService=p,e.StompState=o,e.StompConfig=a,e.StompRPCService=h,e.StompRPCConfig=l,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=stomp-ng2-stompjs.umd.min.js.map